<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Program">   

   	
   	<select id="readProgram" resultType="ProgramRead">
	   select P.id, A.name as name, C.category_name as category_name, P.program_name, P.status, P.start_date, P.end_date , P.Applystart_date, P.Applyend_date , P.manager_name, P.manager_contact, P.applicants_num
		FROM swap.Program as P
		LEFT JOIN swap.Category as C  
		ON P.category_id = C.id
		LEFT JOIN swap.Admin as A
		ON P.admin_id = A.id
		where P.deldate is null
		order by P.regdate desc;
   	</select>
   	
   	
   	<select id="readByCategory" parameterType="Integer" resultType="ProgramRead">
		 select P.id, A.name as name, P.program_name, P.category_id, P.quota, P.information, P.status, P.start_date, P.end_date, P.Applystart_date, P.Applyend_date , P.manager_name, P.manager_contact, P.applicants_num
		FROM Program AS P
		LEFT JOIN Category as C
		ON P.category_id = C.id
		LEFT JOIN swap.Admin as A
		ON P.admin_id = A.id
		where  P.deldate is null AND C.id = #{category_id}
		order by P.regdate desc;
   	</select>
   	
   	
   	<select id="readProgramInformationByProgramId" parameterType="Integer" resultType="ProgramReadById">
	   select P.id, P.program_name,P.category_id, C.category_name as category_name, P.quota, P.information, P.start_date, P.end_date, P.Applystart_date, P.Applyend_date, P.manager_name, P.manager_contact, P.applicants_num
		FROM Program AS P
		LEFT JOIN Category as C  
		ON P.category_id = C.id
		where P.id = #{id};
   	</select>
   	
   	<select id="readProgramName" parameterType="Integer" resultType="ProgramReadName">
	   select P.program_name
		FROM Program AS P
		where P.id = #{id};
   	</select>
   	
   	<insert id = "insertProgram" parameterType="Program">	
   		INSERT INTO Program (admin_id, category_id, application_form, program_name, information, start_date, end_date, quota, Applystart_date, Applyend_date, manager_name, manager_contact)
		VALUES (#{admin_id}, #{category_id}, #{application_form}, #{program_name}, #{information}, #{start_date}, #{end_date},#{quota}, #{Applystart_date}, #{Applyend_date},#{manager_name}, #{manager_contact})
   	</insert>
   	
   	<update id="updateDelDate" parameterType="hashmap">
   		UPDATE Program SET deldate=now(), status = -1
		WHERE id = #{id}
   	</update>
   	

   	<update id="updateStatus" parameterType="hashmap">
   		UPDATE Program SET status=#{status}
		WHERE id = #{program_id}
	</update>

   	<update id="edit" parameterType="Program">
   		UPDATE Program SET edit_date=now(), program_name = #{program_name}, information = #{information}, quota = #{quota}, category_id=#{category_id}, start_date=#{start_date}, end_date=#{end_date}, Applystart_date=#{Applystart_date}, Applyend_date=#{Applyend_date}, manager_name = #{manager_name}, manager_contact = #{manager_contact} 
		WHERE id = #{id}

   	</update>
   	
   	<update id="updateApplicantNum" parameterType="hashmap">
   		UPDATE Program SET applicants_num= applicants_num + 1
   		WHERE id = #{program_id}
	</update>
   	
   	
</mapper>

